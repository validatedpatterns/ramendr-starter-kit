apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  annotations:
    policy.open-cluster-management.io/categories: CA Assessment Authorization and
      Monitoring
    policy.open-cluster-management.io/controls: CA-7 Continuous Monitoring
    policy.open-cluster-management.io/standards: NIST SP 800-53
    argocd.argoproj.io/compare-options: IgnoreExtraneous
    argocd.argoproj.io/sync-options: Prune=false
    argocd.argoproj.io/health-check-ignore: "true"
    argocd.argoproj.io/hook: "PostSync"
    argocd.argoproj.io/sync-wave: "2"
  labels:
    app.kubernetes.io/name: odf-ssl-certificate-management
    app.kubernetes.io/component: policy
  name: policy-odf-ssl-certificate-management
  namespace: open-cluster-management
spec:
  disabled: false
  policy-templates:
  - objectDefinition:
      apiVersion: policy.open-cluster-management.io/v1
      kind: ConfigurationPolicy
      metadata:
        name: policy-odf-ssl-certificate-management
        annotations:
          argocd.argoproj.io/compare-options: IgnoreExtraneous
      spec:
        object-templates:
        - complianceType: musthave
          objectDefinition:
            apiVersion: v1
            kind: ConfigMap
            metadata:
              name: cluster-proxy-ca-bundle
              namespace: openshift-config
              labels:
                app.kubernetes.io/name: odf-ssl-certificate-management
                app.kubernetes.io/component: ca-bundle
              annotations:
                policy.open-cluster-management.io/description: "Combined CA bundle for ODF disaster recovery SSL access"
            data:
              ca-bundle.crt: |
                # This ConfigMap contains the combined CA bundle from hub and managed clusters
                # It is created and maintained by the ODF SSL certificate management system
                # for secure SSL access across clusters in the regional DR setup
        - complianceType: musthave
          objectDefinition:
            apiVersion: config.openshift.io/v1
            kind: Proxy
            metadata:
              name: cluster
              labels:
                app.kubernetes.io/name: odf-ssl-certificate-management
                app.kubernetes.io/component: proxy-config
            spec:
              trustedCA:
                name: cluster-proxy-ca-bundle
        remediationAction: enforce
        severity: high
